<!-- /snippets/nav-item.liquid -->

{%- liquid
  assign parent = false
  assign grandparent = false
  if link.levels == 1
    assign parent = true
  endif
  if link.levels == 2
    assign grandparent = true
  endif

  assign child_count = 0
  if grandparent
    assign child_count = link.links.size
    if child_count > 10
      assign child_count = 10
    endif
  endif

  assign index = index | append: ''
  assign image_count = 0
  assign images_space = 0
  for block in section.blocks
    if block.settings.position == index
      assign grandparent = true
      assign image_count = image_count | plus: 1
      assign image_space = 1
      assign images_space = images_space | plus: image_space
    endif
  endfor


  if parent or grandparent
    assign expands = true
  endif

  if parent and link.levels == 1
    assign child_count = child_count | plus: 1
  endif

  assign link_title_handle = link.title | handle
  assign highlight_links = 'general.header.highlight_links' | t | strip | split: ',' | join: '___' | handle | replace: '___-', '___' | replace: '-___', '___' | split: '___'

-%}
{% capture classes %}{% if grandparent %} grandparent nav-{{ child_count }} {{ blocks_count_class }}{% elsif parent %} parent{% else %} child{% endif %}{% if link.active %} main-menu--active{% endif %}{% endcapture %}

{% assign mega_menu = false %}

 
{% for block in section.blocks %}
  {%- if block.settings.position == index -%}
    {% assign mega_menu = true %}
  {%- endif -%}
{% endfor %}

<li class="header-nav__item {{ classes }} {% if expands %} has-dropdown {% endif %}  {% if mega_menu %} has-megamenu {% endif %}">
  <a
    href="{{ link.url }}"
    class="link-animation-line navlink navlink--toplevel {% if highlight_links contains link_title_handle %} highlight--link{% endif %}"
    {% if expands %}
      aria-haspopup="true"
      aria-expanded="false"
      aria-controls="dropdown-{{ link_title_handle }}-{{ index }}"
    {% endif %}
  >
    <span class="navtext">{{ link.title | strip_html | escape }}</span>
    {% if expands %}
      <span class="svg-icon">
        {% render 'icon' with 'chevron-down', width: '14', height: '14' %}
      </span>
    {% endif %}
  </a>
  

  {% if expands %}
    {%- if grandparent -%}
      {% if mega_menu %}
        <div
          id="dropdown-{{ link_title_handle }}-{{ index}}"
          class="magamenu"
          role="region"
          aria-label="Mega menu for {{ link.title | escape }}"
          aria-labelledby="nav-link-{{ link_title_handle }}"
        >
          <div
            class="megamenu-wrapper gradient"
            data-color-scheme="{{ section.settings.color_scheme_menu }}"
          >
      
            <div class="container">
              <div class="megamenu-inner">

              {% if link.links.size > 0 %}
                
                <nav class="megamenu-menulist megamenu-kds-{{ child_count }}" role="menu" aria-label="Megamenu for {{ link.title | escape }}">
                  {% for link in link.links %}
                    {% assign link_title_handle = link.title | handle %}
                    <div class="column">
                      <div class="megamenu-list">
                        <a
                          href="{{ link.url }}"
                          class="megamenu-title"
                        >
                          <span class="navtext">{{ link.title | strip_html | escape }}</span>
                        </a>

                        {%- if link.links.size > 0 -%}
                          <ul role="list">
                            {% for link in link.links %}
                              <li>
                                {% assign link_title_handle = link.title | handle %}

                                <a
                                  href="{{ link.url }}"
                                  data-stagger-second
                                  class="link-animation"
                                >
                                  {% if link.title contains '[' %}
                                    {% assign title = link.title | split: '[' %}
                                    {{ title[0] | strip_html | escape }}
                                    <span class="badge badge--{{ title[1] | remove_last: ']' | handleize }}">
                                      {{ title[1] | remove_last: ']' | strip_html | escape }}
                                    </span>
                                  {% else %}
                                    <span class="navtext">{{ link.title | strip_html | escape }}</span>
                                  {% endif %}
                                </a>
                              </li>
                            {% endfor %}
                          </ul>
                        {%- endif -%}
                      </div>
                    </div>
                  {% endfor %}
                </nav>

                  {% endif %}

                  
              {%- liquid
                if image_count == 2
                  assign images_space = 2
               
               elsif image_count == 6 and child_count > 0
               assign images_space = 3
               elsif image_count == 4 
                   assign images_space = 4
                    elsif image_count == 5  
                   assign images_space = 5
                 elsif image_count == 6 
                   assign images_space = 6
                 elsif image_count == 7 
                   assign images_space = 4
                 elsif image_count == 8
                   assign images_space = 4
                 elsif image_count == 9
                   assign images_space = 5
                 elsif image_count == 10
                   assign images_space = 5
                   
                endif
              -%}
                <aside class="megamenu-blocks  megamenu-blocks-{{ child_count }}" style="--images-space: {{ images_space }};">
                  {% for block in section.blocks %}
                    {% comment %} Render block content {% endcomment %}
                    {%- if block.settings.position == index -%}
                      {% render 'header-block', block: block, column_count: child_count %}
                    {%- endif -%}
                  {% endfor %}
                  </aside>
          
              </div>
            </div>
          </div>
        </div>
      {% else %}
        <div
          id="dropdown-{{ link_title_handle }}-{{ index }}"
          class="dropdown-menu"
          role="region"
          aria-label="dropdown for {{ link.title | escape }}"
          aria-labelledby="nav-link-{{ link_title_handle }}"
        >
          <div
            class="dropdown-menu-wrapper gradient"
            data-color-scheme="{{ section.settings.color_scheme_menu }}"
          >
            <span class="chevron-arrow svg-icon">
              {% render 'icon' with 'chevron-arrow', width: '41', height: '14' %}
            </span>

            <ul role="list" class="dropdown-menu-list">
              {% for link in link.links %}
                <li class="{%- if link.links.size > 0 -%} has-submenu {%- endif -%}">
                  {% assign link_title_handle = link.title | handle %}
                  <a
                    href="{{ link.url }}"
                    class="navlink navlink--grandchild{% if link.active %} main-menu--active{% endif %}{% if highlight_links contains link_title_handle %} highlight--link{% endif %}"
                  >
                    <span class="navtext">{{ link.title | strip_html | escape }}</span>
                    {% if link.links.size > 0 %}
                      <span class="svg-icon">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="16"
                          height="16"
                          fill="#000000"
                          viewBox="0 0 256 256"
                        >
                          <path d="M184.49,136.49l-80,80a12,12,0,0,1-17-17L159,128,87.51,56.49a12,12,0,1,1,17-17l80,80A12,12,0,0,1,184.49,136.49Z"></path>
                        </svg>
                      </span>
                    {% endif %}
                  </a>
                  {%- if link.links.size > 0 -%}
                    <!-- DROP DOWN SUBMENU -->
                    <div class="submenu">
                      <div class="submenu-wrapper">
                        <span class="chevron-arrow-left svg-icon">
                          {% render 'icon' with 'chevron-arrow-left', width: '14', height: '41' %}
                        </span>

                        <ul role="list" class="submenu-list">
                          {% for link in link.links %}
                            <li>
                              {% assign link_title_handle = link.title | handle %}
                              <a
                                href="{{ link.url }}"
                                data-stagger-second
                                class="navlink navlink--grandchild{% if link.active %} main-menu--active{% endif %}{% if highlight_links contains link_title_handle %} highlight--link{% endif %}"
                              >
                                {% if link.title contains '[' %}
                                  {% assign title = link.title | split: '[' %}
                                  {{ title[0] | strip_html | escape }}
                                  <span class="badge badge--{{ title[1] | remove_last: ']' | handleize }}">
                                    {{ title[1] | remove_last: ']' | strip_html | escape }}
                                  </span>
                                {% else %}
                                  <span class="navtext">{{ link.title | strip_html | escape }}</span>
                                {% endif %}
                              </a>
                            </li>
                          {% endfor %}
                        </ul>
                      </div>
                    </div>
                  {%- endif -%}
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      {% endif %}

    {%- else -%}
      <div
        id="dropdown-{{ link_title_handle }}-{{ index }}"
        class="dropdown-menu"
        role="menu"
        aria-label="dropdown for {{ link.title | escape }}"
        aria-labelledby="nav-link-{{ link_title_handle }}"
      >
        <div
          class="dropdown-menu-wrapper gradient"
          data-color-scheme="{{ section.settings.color_scheme_menu }}"
        >
          <span class="chevron-arrow svg-icon">
            {% render 'icon' with 'chevron-arrow', width: '41', height: '14' %}
          </span>

          <ul role="list" class="dropdown-menu-list">
            {% for link in link.links %}
              {% assign link_title_handle = link.title | handle %}
              <li>
                <a
                  href="{{ link.url }}"
                  data-stagger
                  class="navlink navlink--child{% if link.active %} main-menu--active{% endif %}{% if highlight_links contains link_title_handle %} highlight--link{% endif %}"
                >
                  <span class="navtext">{{ link.title | strip_html | escape }}</span>
                </a>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    {%- endif -%}
  {%- endif -%}
</li>
